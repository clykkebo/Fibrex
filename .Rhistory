# load
params <- readRDS("R_objects/params_betadiv.RDS")
for (MTRL in MTRLS) {
load(paste0("R_objects/Phyloseq_betadiv_",MTRL,".Rdata"))
# Calculate Jaccard binary dissimilarities
jac.dist <- distance(phy.rare, method = "jaccard", binary = TRUE)
# Calculate PCoA data
jac.pcoa <- ordinate(phy.rare, method = "PCoA",distance = jac.dist)
jac.nmds <- metaMDS(jac.dist, k = 5, trymax = 1000)
# Save distance objects
save(jac.dist, jac.nmds, jac.pcoa, phy.rare, file = paste0("R_objects/bdiv_unif_",MTRL,".RData"))
}
# clear the environment and release memory
rm(list = ls(all.names = TRUE))
invisible(gc())
MTRLS <- c("Feces","Cecum","Ileum")
# load
params <- readRDS("R_objects/params_betadiv.RDS")
for (MTRL in MTRLS) {
load(paste0("R_objects/Phyloseq_betadiv_",MTRL,".Rdata"))
# Calculate Bray-Curtis dissimilarities
ait.dist <- vegan::vegdist(otu_table(phy.clean), method = "robust.aitchison")
# Calculate PCoA data
ait.pcoa <- ordinate(phy.clean, method = "PCoA",distance = ait.dist)
ait.nmds <- metaMDS(ait.dist, k = 5, trymax = 1000)
# Save distance objects
save(ait.dist, ait.nmds, ait.pcoa, phy.clean, file = paste0("R_objects/bdiv_unif_",MTRL,".RData"))
}
# clear the environment and release memory
rm(list = ls(all.names = TRUE))
invisible(gc())
METRICES <- c("bray","unif","wuf","jac","ait")
DAYS <- c("d0","d08","d12","d16","d20","d21")
FEEDS <- c("A","B","ALL")
MTRLS <- c("Cecum","Ileum")
# load
params <- readRDS("R_objects/params_betadiv.RDS")
load("R_objects/Phyloseq_betadiv.Rdata")
for (MTRL in MTRLS) {
message(paste0("Running loop for calculation of beta diversity subsets for ",MTRL,"."))
if (MTRL == "Cecum" || MTRL == "Ileum") {
DAYS <- c("d08","d21")
} else if (MTRL == "Feces") {
DAYS <- c("d0","d08","d12","d16","d20","d21")
}
for (DAY in DAYS) {
print(paste0("Processing day ",DAY,"..."))
for (FEED in FEEDS) {
for (METRIC in METRICES) {
load(paste0("R_objects/Phyloseq_betadiv_",MTRL,".Rdata"))
if (FEED == "ALL") {
FILENAME <- paste0("R_objects/bdiv_sub_",MTRL,"_",DAY,"_",METRIC,".Rdata")
} else {
FILENAME <- paste0("R_objects/bdiv_sub_",MTRL,"_",DAY,"_",FEED,"_",METRIC,".Rdata")
}
if (METRIC == "unif") {
load(paste0("R_objects/bdiv_unif_",MTRL,".RData"))
tmp.dist <- as.matrix(unif.dist)
if (FEED == "ALL") {
phy.sub <- subset_samples(phy.rare, material == MTRL & day %in% DAY)
} else {
phy.sub <- subset_samples(phy.rare, material == MTRL & day %in% DAY & feed %in% FEED)
}
SUBS <- sample_names(phy.sub)
tmp.sub.dist <- tmp.dist[SUBS, SUBS]
unif.sub.dist <- as.dist(tmp.sub.dist, diag = TRUE, upper = TRUE)
unif.sub.pcoa <- ordinate(phy.sub, method = "PCoA",distance = unif.sub.dist)
unif.sub.nmds <- metaMDS(unif.sub.dist, k = 5, trymax = 1000)
save(phy.sub, unif.sub.dist, unif.sub.nmds, unif.sub.pcoa, file = FILENAME)
} else if (METRIC == "wuf") {
load(paste0("R_objects/bdiv_wunif_",MTRL,".RData"))
tmp.dist <- as.matrix(wuf.dist)
if (FEED == "ALL") {
phy.sub <- subset_samples(phy.clean, material == MTRL & day %in% DAY)
} else {
phy.sub <- subset_samples(phy.clean, material == MTRL & day %in% DAY & feed %in% FEED)
}
SUBS <- sample_names(phy.sub)
tmp.sub.dist <- tmp.dist[SUBS, SUBS]
wuf.sub.dist <- as.dist(tmp.sub.dist, diag = TRUE, upper = TRUE)
wuf.sub.pcoa <- ordinate(phy.sub, method = "PCoA",distance = wuf.sub.dist)
wuf.sub.nmds <- metaMDS(wuf.sub.dist, k = 5, trymax = 1000)
save(phy.sub, wuf.sub.dist, wuf.sub.nmds, wuf.sub.pcoa, file = FILENAME)
} else if (METRIC == "bray") {
load(paste0("R_objects/bdiv_bray_",MTRL,".RData"))
tmp.dist <- as.matrix(bray.dist)
if (FEED == "ALL") {
phy.sub <- subset_samples(phy.rare, material == MTRL & day %in% DAY)
} else {
phy.sub <- subset_samples(phy.rare, material == MTRL & day %in% DAY & feed %in% FEED)
}
SUBS <- sample_names(phy.sub)
tmp.sub.dist <- tmp.dist[SUBS, SUBS]
bray.sub.dist <- as.dist(tmp.sub.dist, diag = TRUE, upper = TRUE)
bray.sub.pcoa <- ordinate(phy.sub, method = "PCoA", distance = bray.sub.dist)
bray.sub.nmds <- metaMDS(bray.sub.dist, k = 5, trymax = 1000)
save(phy.sub, bray.sub.dist, bray.sub.pcoa, bray.sub.nmds, file = FILENAME)
} else if (METRIC == "jac") {
load(paste0("R_objects/bdiv_jac_",MTRL,".RData"))
tmp.dist <- as.matrix(jac.dist)
if (FEED == "ALL") {
phy.sub <- subset_samples(phy.rare, material == MTRL & day %in% DAY)
} else {
phy.sub <- subset_samples(phy.rare, material == MTRL & day %in% DAY & feed %in% FEED)
}
SUBS <- sample_names(phy.sub)
tmp.sub.dist <- tmp.dist[SUBS, SUBS]
jac.sub.dist <- as.dist(tmp.sub.dist, diag = TRUE, upper = TRUE)
jac.sub.pcoa <- ordinate(phy.sub, method = "PCoA", distance = jac.sub.dist)
jac.sub.nmds <- metaMDS(jac.sub.dist, k = 5, trymax = 1000)
save(phy.sub, jac.sub.dist, jac.sub.pcoa, jac.sub.nmds, file = FILENAME)
} else if (METRIC == "ait") {
load(paste0("R_objects/bdiv_ait_",MTRL,".RData"))
tmp.dist <- as.matrix(ait.dist)
if (FEED == "ALL") {
phy.sub <- subset_samples(phy.clean, material == MTRL & day %in% DAY)
} else {
phy.sub <- subset_samples(phy.clean, material == MTRL & day %in% DAY & feed %in% FEED)
}
SUBS <- sample_names(phy.sub)
tmp.sub.dist <- tmp.dist[SUBS, SUBS]
ait.sub.dist <- as.dist(tmp.sub.dist, diag = TRUE, upper = TRUE)
ait.sub.pcoa <- ordinate(phy.sub, method = "PCoA", distance = ait.sub.dist)
ait.sub.nmds <- metaMDS(ait.sub.dist, k = 5, trymax = 1000)
save(phy.sub, ait.sub.dist, ait.sub.pcoa, ait.sub.nmds, file = FILENAME)
}
}
}
}
}
MTRLS <- c("Feces","Cecum","Ileum")
# load
params <- readRDS("R_objects/params_betadiv.RDS")
for (MTRL in MTRLS) {
load(paste0("R_objects/Phyloseq_betadiv_",MTRL,".Rdata"))
# Calculate UniFrac distances
unif.dist <- UniFrac(phy.rare, weighted = FALSE, parallel = FALSE)
# Calculate PCoA data
unif.pcoa <- ordinate(phy.rare, method = "PCoA",distance = unif.dist)
unif.nmds <- metaMDS(unif.dist, k = 5, trymax = 1000)
# Save distance objects
save(unif.dist, unif.nmds, unif.pcoa, phy.rare, file = paste0("R_objects/bdiv_unif_",MTRL,".RData"))
}
# clear the environment and release memory
rm(list = ls(all.names = TRUE))
invisible(gc())
MTRLS <- c("Feces","Cecum","Ileum")
# load
params <- readRDS("R_objects/params_betadiv.RDS")
for (MTRL in MTRLS) {
load(paste0("R_objects/Phyloseq_betadiv_",MTRL,".Rdata"))
# Calculate UniFrac distances
wuf.dist <- UniFrac(phy.clean, weighted = TRUE, parallel = FALSE)
# Calculate PCoA data
wuf.pcoa <- ordinate(phy.clean, method = "PCoA",distance = wuf.dist)
wuf.nmds <- metaMDS(wuf.dist, k = 5, trymax = 1000)
# Save distance objects
save(wuf.dist, wuf.nmds, wuf.pcoa, phy.clean, file = paste0("R_objects/bdiv_wuf_",MTRL,".RData"))
}
# clear the environment and release memory
rm(list = ls(all.names = TRUE))
invisible(gc())
MTRLS <- c("Feces","Cecum","Ileum")
# load
params <- readRDS("R_objects/params_betadiv.RDS")
for (MTRL in MTRLS) {
load(paste0("R_objects/Phyloseq_betadiv_",MTRL,".Rdata"))
# transform counts
phy.ra <- transform_sample_counts(phy.clean, function(x) x/sum(x))
# Calculate Bray-Curtis dissimilarities
bray.dist <- distance(phy.ra, method = "bray",)
# Calculate PCoA data
bray.pcoa <- ordinate(phy.ra, method = "PCoA",distance = bray.dist)
bray.nmds <- metaMDS(bray.dist, k = 5, trymax = 1000)
# Save distance objects
save(bray.dist, bray.nmds, bray.pcoa, phy.ra, file = paste0("R_objects/bdiv_bray_",MTRL,".RData"))
}
# clear the environment and release memory
rm(list = ls(all.names = TRUE))
invisible(gc())
MTRLS <- c("Feces","Cecum","Ileum")
# load
params <- readRDS("R_objects/params_betadiv.RDS")
for (MTRL in MTRLS) {
load(paste0("R_objects/Phyloseq_betadiv_",MTRL,".Rdata"))
# Calculate Jaccard binary dissimilarities
jac.dist <- distance(phy.rare, method = "jaccard", binary = TRUE)
# Calculate PCoA data
jac.pcoa <- ordinate(phy.rare, method = "PCoA",distance = jac.dist)
jac.nmds <- metaMDS(jac.dist, k = 5, trymax = 1000)
# Save distance objects
save(jac.dist, jac.nmds, jac.pcoa, phy.rare, file = paste0("R_objects/bdiv_jac_",MTRL,".RData"))
}
# clear the environment and release memory
rm(list = ls(all.names = TRUE))
invisible(gc())
MTRLS <- c("Feces","Cecum","Ileum")
# load
params <- readRDS("R_objects/params_betadiv.RDS")
for (MTRL in MTRLS) {
load(paste0("R_objects/Phyloseq_betadiv_",MTRL,".Rdata"))
# Calculate Bray-Curtis dissimilarities
ait.dist <- vegan::vegdist(otu_table(phy.clean), method = "robust.aitchison")
# Calculate PCoA data
ait.pcoa <- ordinate(phy.clean, method = "PCoA",distance = ait.dist)
ait.nmds <- metaMDS(ait.dist, k = 5, trymax = 1000)
# Save distance objects
save(ait.dist, ait.nmds, ait.pcoa, phy.clean, file = paste0("R_objects/bdiv_ait_",MTRL,".RData"))
}
# clear the environment and release memory
rm(list = ls(all.names = TRUE))
invisible(gc())
METRICES <- c("bray","unif","wuf","jac","ait")
DAYS <- c("d0","d08","d12","d16","d20","d21")
FEEDS <- c("A","B","ALL")
MTRLS <- c("Cecum","Ileum")
# load
params <- readRDS("R_objects/params_betadiv.RDS")
load("R_objects/Phyloseq_betadiv.Rdata")
for (MTRL in MTRLS) {
message(paste0("Running loop for calculation of beta diversity subsets for ",MTRL,"."))
if (MTRL == "Cecum" || MTRL == "Ileum") {
DAYS <- c("d08","d21")
} else if (MTRL == "Feces") {
DAYS <- c("d0","d08","d12","d16","d20","d21")
}
for (DAY in DAYS) {
print(paste0("Processing day ",DAY,"..."))
for (FEED in FEEDS) {
for (METRIC in METRICES) {
load(paste0("R_objects/Phyloseq_betadiv_",MTRL,".Rdata"))
if (FEED == "ALL") {
FILENAME <- paste0("R_objects/bdiv_sub_",MTRL,"_",DAY,"_",METRIC,".Rdata")
} else {
FILENAME <- paste0("R_objects/bdiv_sub_",MTRL,"_",DAY,"_",FEED,"_",METRIC,".Rdata")
}
if (METRIC == "unif") {
load(paste0("R_objects/bdiv_unif_",MTRL,".RData"))
tmp.dist <- as.matrix(unif.dist)
if (FEED == "ALL") {
phy.sub <- subset_samples(phy.rare, material == MTRL & day %in% DAY)
} else {
phy.sub <- subset_samples(phy.rare, material == MTRL & day %in% DAY & feed %in% FEED)
}
SUBS <- sample_names(phy.sub)
tmp.sub.dist <- tmp.dist[SUBS, SUBS]
unif.sub.dist <- as.dist(tmp.sub.dist, diag = TRUE, upper = TRUE)
unif.sub.pcoa <- ordinate(phy.sub, method = "PCoA",distance = unif.sub.dist)
unif.sub.nmds <- metaMDS(unif.sub.dist, k = 5, trymax = 1000)
save(phy.sub, unif.sub.dist, unif.sub.nmds, unif.sub.pcoa, file = FILENAME)
} else if (METRIC == "wuf") {
load(paste0("R_objects/bdiv_wunif_",MTRL,".RData"))
tmp.dist <- as.matrix(wuf.dist)
if (FEED == "ALL") {
phy.sub <- subset_samples(phy.clean, material == MTRL & day %in% DAY)
} else {
phy.sub <- subset_samples(phy.clean, material == MTRL & day %in% DAY & feed %in% FEED)
}
SUBS <- sample_names(phy.sub)
tmp.sub.dist <- tmp.dist[SUBS, SUBS]
wuf.sub.dist <- as.dist(tmp.sub.dist, diag = TRUE, upper = TRUE)
wuf.sub.pcoa <- ordinate(phy.sub, method = "PCoA",distance = wuf.sub.dist)
wuf.sub.nmds <- metaMDS(wuf.sub.dist, k = 5, trymax = 1000)
save(phy.sub, wuf.sub.dist, wuf.sub.nmds, wuf.sub.pcoa, file = FILENAME)
} else if (METRIC == "bray") {
load(paste0("R_objects/bdiv_bray_",MTRL,".RData"))
tmp.dist <- as.matrix(bray.dist)
if (FEED == "ALL") {
phy.sub <- subset_samples(phy.rare, material == MTRL & day %in% DAY)
} else {
phy.sub <- subset_samples(phy.rare, material == MTRL & day %in% DAY & feed %in% FEED)
}
SUBS <- sample_names(phy.sub)
tmp.sub.dist <- tmp.dist[SUBS, SUBS]
bray.sub.dist <- as.dist(tmp.sub.dist, diag = TRUE, upper = TRUE)
bray.sub.pcoa <- ordinate(phy.sub, method = "PCoA", distance = bray.sub.dist)
bray.sub.nmds <- metaMDS(bray.sub.dist, k = 5, trymax = 1000)
save(phy.sub, bray.sub.dist, bray.sub.pcoa, bray.sub.nmds, file = FILENAME)
} else if (METRIC == "jac") {
load(paste0("R_objects/bdiv_jac_",MTRL,".RData"))
tmp.dist <- as.matrix(jac.dist)
if (FEED == "ALL") {
phy.sub <- subset_samples(phy.rare, material == MTRL & day %in% DAY)
} else {
phy.sub <- subset_samples(phy.rare, material == MTRL & day %in% DAY & feed %in% FEED)
}
SUBS <- sample_names(phy.sub)
tmp.sub.dist <- tmp.dist[SUBS, SUBS]
jac.sub.dist <- as.dist(tmp.sub.dist, diag = TRUE, upper = TRUE)
jac.sub.pcoa <- ordinate(phy.sub, method = "PCoA", distance = jac.sub.dist)
jac.sub.nmds <- metaMDS(jac.sub.dist, k = 5, trymax = 1000)
save(phy.sub, jac.sub.dist, jac.sub.pcoa, jac.sub.nmds, file = FILENAME)
} else if (METRIC == "ait") {
load(paste0("R_objects/bdiv_ait_",MTRL,".RData"))
tmp.dist <- as.matrix(ait.dist)
if (FEED == "ALL") {
phy.sub <- subset_samples(phy.clean, material == MTRL & day %in% DAY)
} else {
phy.sub <- subset_samples(phy.clean, material == MTRL & day %in% DAY & feed %in% FEED)
}
SUBS <- sample_names(phy.sub)
tmp.sub.dist <- tmp.dist[SUBS, SUBS]
ait.sub.dist <- as.dist(tmp.sub.dist, diag = TRUE, upper = TRUE)
ait.sub.pcoa <- ordinate(phy.sub, method = "PCoA", distance = ait.sub.dist)
ait.sub.nmds <- metaMDS(ait.sub.dist, k = 5, trymax = 1000)
save(phy.sub, ait.sub.dist, ait.sub.pcoa, ait.sub.nmds, file = FILENAME)
}
}
}
}
}
METRICES <- c("bray","unif","wuf","jac","ait")
DAYS <- c("d0","d08","d12","d16","d20","d21")
FEEDS <- c("A","B","ALL")
MTRLS <- c("Feces","Cecum","Ileum")
# load
params <- readRDS("R_objects/params_betadiv.RDS")
#load("R_objects/Phyloseq_betadiv.Rdata")
for (MTRL in MTRLS) {
message(paste0("Running loop for calculation of beta diversity subsets for ",MTRL,"."))
if (MTRL == "Cecum" || MTRL == "Ileum") {
DAYS <- c("d08","d21")
} else if (MTRL == "Feces") {
DAYS <- c("d0","d08","d12","d16","d20","d21")
}
for (DAY in DAYS) {
print(paste0("Processing day ",DAY,"..."))
for (FEED in FEEDS) {
for (METRIC in METRICES) {
load(paste0("R_objects/Phyloseq_betadiv_",MTRL,".Rdata"))
if (FEED == "ALL") {
FILENAME <- paste0("R_objects/bdiv_sub_",MTRL,"_",DAY,"_",METRIC,".Rdata")
} else {
FILENAME <- paste0("R_objects/bdiv_sub_",MTRL,"_",DAY,"_",FEED,"_",METRIC,".Rdata")
}
if (METRIC == "unif") {
load(paste0("R_objects/bdiv_unif_",MTRL,".RData"))
tmp.dist <- as.matrix(unif.dist)
if (FEED == "ALL") {
phy.sub <- subset_samples(phy.rare, material == MTRL & day %in% DAY)
} else {
phy.sub <- subset_samples(phy.rare, material == MTRL & day %in% DAY & feed %in% FEED)
}
SUBS <- sample_names(phy.sub)
tmp.sub.dist <- tmp.dist[SUBS, SUBS]
unif.sub.dist <- as.dist(tmp.sub.dist, diag = TRUE, upper = TRUE)
unif.sub.pcoa <- ordinate(phy.sub, method = "PCoA",distance = unif.sub.dist)
unif.sub.nmds <- metaMDS(unif.sub.dist, k = 5, trymax = 1000)
save(phy.sub, unif.sub.dist, unif.sub.nmds, unif.sub.pcoa, file = FILENAME)
} else if (METRIC == "wuf") {
load(paste0("R_objects/bdiv_wunif_",MTRL,".RData"))
tmp.dist <- as.matrix(wuf.dist)
if (FEED == "ALL") {
phy.sub <- subset_samples(phy.clean, material == MTRL & day %in% DAY)
} else {
phy.sub <- subset_samples(phy.clean, material == MTRL & day %in% DAY & feed %in% FEED)
}
SUBS <- sample_names(phy.sub)
tmp.sub.dist <- tmp.dist[SUBS, SUBS]
wuf.sub.dist <- as.dist(tmp.sub.dist, diag = TRUE, upper = TRUE)
wuf.sub.pcoa <- ordinate(phy.sub, method = "PCoA",distance = wuf.sub.dist)
wuf.sub.nmds <- metaMDS(wuf.sub.dist, k = 5, trymax = 1000)
save(phy.sub, wuf.sub.dist, wuf.sub.nmds, wuf.sub.pcoa, file = FILENAME)
} else if (METRIC == "bray") {
load(paste0("R_objects/bdiv_bray_",MTRL,".RData"))
tmp.dist <- as.matrix(bray.dist)
if (FEED == "ALL") {
phy.sub <- subset_samples(phy.rare, material == MTRL & day %in% DAY)
} else {
phy.sub <- subset_samples(phy.rare, material == MTRL & day %in% DAY & feed %in% FEED)
}
SUBS <- sample_names(phy.sub)
tmp.sub.dist <- tmp.dist[SUBS, SUBS]
bray.sub.dist <- as.dist(tmp.sub.dist, diag = TRUE, upper = TRUE)
bray.sub.pcoa <- ordinate(phy.sub, method = "PCoA", distance = bray.sub.dist)
bray.sub.nmds <- metaMDS(bray.sub.dist, k = 5, trymax = 1000)
save(phy.sub, bray.sub.dist, bray.sub.pcoa, bray.sub.nmds, file = FILENAME)
} else if (METRIC == "jac") {
load(paste0("R_objects/bdiv_jac_",MTRL,".RData"))
tmp.dist <- as.matrix(jac.dist)
if (FEED == "ALL") {
phy.sub <- subset_samples(phy.rare, material == MTRL & day %in% DAY)
} else {
phy.sub <- subset_samples(phy.rare, material == MTRL & day %in% DAY & feed %in% FEED)
}
SUBS <- sample_names(phy.sub)
tmp.sub.dist <- tmp.dist[SUBS, SUBS]
jac.sub.dist <- as.dist(tmp.sub.dist, diag = TRUE, upper = TRUE)
jac.sub.pcoa <- ordinate(phy.sub, method = "PCoA", distance = jac.sub.dist)
jac.sub.nmds <- metaMDS(jac.sub.dist, k = 5, trymax = 1000)
save(phy.sub, jac.sub.dist, jac.sub.pcoa, jac.sub.nmds, file = FILENAME)
} else if (METRIC == "ait") {
load(paste0("R_objects/bdiv_ait_",MTRL,".RData"))
tmp.dist <- as.matrix(ait.dist)
if (FEED == "ALL") {
phy.sub <- subset_samples(phy.clean, material == MTRL & day %in% DAY)
} else {
phy.sub <- subset_samples(phy.clean, material == MTRL & day %in% DAY & feed %in% FEED)
}
SUBS <- sample_names(phy.sub)
tmp.sub.dist <- tmp.dist[SUBS, SUBS]
ait.sub.dist <- as.dist(tmp.sub.dist, diag = TRUE, upper = TRUE)
ait.sub.pcoa <- ordinate(phy.sub, method = "PCoA", distance = ait.sub.dist)
ait.sub.nmds <- metaMDS(ait.sub.dist, k = 5, trymax = 1000)
save(phy.sub, ait.sub.dist, ait.sub.pcoa, ait.sub.nmds, file = FILENAME)
}
}
}
}
}
METRICES <- c("bray","unif","wuf","jac","ait")
DAYS <- c("d0","d08","d12","d16","d20","d21")
FEEDS <- c("A","B","ALL")
MTRLS <- c("Feces","Cecum","Ileum")
# load
params <- readRDS("R_objects/params_betadiv.RDS")
#load("R_objects/Phyloseq_betadiv.Rdata")
for (MTRL in MTRLS) {
message(paste0("Running loop for calculation of beta diversity subsets for ",MTRL,"."))
if (MTRL == "Cecum" || MTRL == "Ileum") {
DAYS <- c("d08","d21")
} else if (MTRL == "Feces") {
DAYS <- c("d0","d08","d12","d16","d20","d21")
}
for (DAY in DAYS) {
print(paste0("Processing day ",DAY,"..."))
for (FEED in FEEDS) {
for (METRIC in METRICES) {
load(paste0("R_objects/Phyloseq_betadiv_",MTRL,".Rdata"))
if (FEED == "ALL") {
FILENAME <- paste0("R_objects/bdiv_sub_",MTRL,"_",DAY,"_",METRIC,".Rdata")
} else {
FILENAME <- paste0("R_objects/bdiv_sub_",MTRL,"_",DAY,"_",FEED,"_",METRIC,".Rdata")
}
if (METRIC == "unif") {
load(paste0("R_objects/bdiv_unif_",MTRL,".RData"))
tmp.dist <- as.matrix(unif.dist)
if (FEED == "ALL") {
phy.sub <- subset_samples(phy.rare, material == MTRL & day %in% DAY)
} else {
phy.sub <- subset_samples(phy.rare, material == MTRL & day %in% DAY & feed %in% FEED)
}
SUBS <- sample_names(phy.sub)
tmp.sub.dist <- tmp.dist[SUBS, SUBS]
unif.sub.dist <- as.dist(tmp.sub.dist, diag = TRUE, upper = TRUE)
unif.sub.pcoa <- ordinate(phy.sub, method = "PCoA",distance = unif.sub.dist)
unif.sub.nmds <- metaMDS(unif.sub.dist, k = 5, trymax = 1000)
save(phy.sub, unif.sub.dist, unif.sub.nmds, unif.sub.pcoa, file = FILENAME)
} else if (METRIC == "wuf") {
load(paste0("R_objects/bdiv_wuf_",MTRL,".RData"))
tmp.dist <- as.matrix(wuf.dist)
if (FEED == "ALL") {
phy.sub <- subset_samples(phy.clean, material == MTRL & day %in% DAY)
} else {
phy.sub <- subset_samples(phy.clean, material == MTRL & day %in% DAY & feed %in% FEED)
}
SUBS <- sample_names(phy.sub)
tmp.sub.dist <- tmp.dist[SUBS, SUBS]
wuf.sub.dist <- as.dist(tmp.sub.dist, diag = TRUE, upper = TRUE)
wuf.sub.pcoa <- ordinate(phy.sub, method = "PCoA",distance = wuf.sub.dist)
wuf.sub.nmds <- metaMDS(wuf.sub.dist, k = 5, trymax = 1000)
save(phy.sub, wuf.sub.dist, wuf.sub.nmds, wuf.sub.pcoa, file = FILENAME)
} else if (METRIC == "bray") {
load(paste0("R_objects/bdiv_bray_",MTRL,".RData"))
tmp.dist <- as.matrix(bray.dist)
if (FEED == "ALL") {
phy.sub <- subset_samples(phy.rare, material == MTRL & day %in% DAY)
} else {
phy.sub <- subset_samples(phy.rare, material == MTRL & day %in% DAY & feed %in% FEED)
}
SUBS <- sample_names(phy.sub)
tmp.sub.dist <- tmp.dist[SUBS, SUBS]
bray.sub.dist <- as.dist(tmp.sub.dist, diag = TRUE, upper = TRUE)
bray.sub.pcoa <- ordinate(phy.sub, method = "PCoA", distance = bray.sub.dist)
bray.sub.nmds <- metaMDS(bray.sub.dist, k = 5, trymax = 1000)
save(phy.sub, bray.sub.dist, bray.sub.pcoa, bray.sub.nmds, file = FILENAME)
} else if (METRIC == "jac") {
load(paste0("R_objects/bdiv_jac_",MTRL,".RData"))
tmp.dist <- as.matrix(jac.dist)
if (FEED == "ALL") {
phy.sub <- subset_samples(phy.rare, material == MTRL & day %in% DAY)
} else {
phy.sub <- subset_samples(phy.rare, material == MTRL & day %in% DAY & feed %in% FEED)
}
SUBS <- sample_names(phy.sub)
tmp.sub.dist <- tmp.dist[SUBS, SUBS]
jac.sub.dist <- as.dist(tmp.sub.dist, diag = TRUE, upper = TRUE)
jac.sub.pcoa <- ordinate(phy.sub, method = "PCoA", distance = jac.sub.dist)
jac.sub.nmds <- metaMDS(jac.sub.dist, k = 5, trymax = 1000)
save(phy.sub, jac.sub.dist, jac.sub.pcoa, jac.sub.nmds, file = FILENAME)
} else if (METRIC == "ait") {
load(paste0("R_objects/bdiv_ait_",MTRL,".RData"))
tmp.dist <- as.matrix(ait.dist)
if (FEED == "ALL") {
phy.sub <- subset_samples(phy.clean, material == MTRL & day %in% DAY)
} else {
phy.sub <- subset_samples(phy.clean, material == MTRL & day %in% DAY & feed %in% FEED)
}
SUBS <- sample_names(phy.sub)
tmp.sub.dist <- tmp.dist[SUBS, SUBS]
ait.sub.dist <- as.dist(tmp.sub.dist, diag = TRUE, upper = TRUE)
ait.sub.pcoa <- ordinate(phy.sub, method = "PCoA", distance = ait.sub.dist)
ait.sub.nmds <- metaMDS(ait.sub.dist, k = 5, trymax = 1000)
save(phy.sub, ait.sub.dist, ait.sub.pcoa, ait.sub.nmds, file = FILENAME)
}
}
}
}
}
# clear the environment and release memory
rm(list = ls(all.names = TRUE))
invisible(gc())
